#!/bin/bash

#
# configure build.xml, environment variables and makefile
#

declare -a jnidir

i=1
srcdir=$(dirname $(readlink -f $0))
rpnhome=$(dirname $srcdir)
jni=`locate jni.h`
hosttype="linux_"`uname -m`

echo; echo "Choose the JAVA_HOME installation path below: "; echo

for j in `echo $jni`; do
	j=`dirname $j`
	j=`dirname $j`
	jnidir[$i]=$j

	echo "      "$i") "${jnidir[$i]}
	i=$(($i + 1))
done

echo "      "$i") None of the above. Entre JAVA_HOME manually."
echo -n "      > "; read -n 1 ans; echo

if [ $ans == $i ]; then
	echo -n "Entre JAVA_HOME path: "
	read javahome
else 
	javahome=${jnidir[$ans]}
fi

#
# Create build.xml
#
sed -e "s,PRE_CONFIG_HOSTTYPE,$hosttype,g" $srcdir/make/build.xml.in > $srcdir/build.xml

#
# Create make/env file
#
sed -e "s,PRE_CONFIG_HOSTTYPE,$hosttype,g" -e "s,PRE_CONFIG_JAVAHOME,$javahome,g" $srcdir/make/env.in > $srcdir/make/env


echo
echo
echo "Final Configuration:"
echo
echo -e "\tRPn_HOME:  \033[31m $rpnhome \033[0m"
echo -e "\tMACHNINE:  \033[31m $hosttype \033[0m"
echo -e "\tJAVA_HOME: \033[31m $javahome \033[0m"
echo
echo
echo -e "Now, run\033[32m 'ant' \033[0mto build RPn."
echo -e "Use\033[32m 'ant run' \033[0mto execute the program."
echo
